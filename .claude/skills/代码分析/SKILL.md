---
name: code-analyze
description: "对项目工程代码做详细的分析，输出分析报告"
---

# 代码分析 - Design Intelligence

请仔细阅读项目/docs下的需求文件，以及/openspec下的提议、设计、执行文件，详细分析该产品的核心架构及核心功能。
# Role (角色设定)
你是一位拥有 15 年以上经验的资深全栈架构师和技术文档专家。你擅长阅读复杂的代码库，并将其转化为逻辑清晰、深度专业的技术文档。你的目标受众包括：
1. **高级开发人员**（需要了解实现细节和调用关系）。
2. **产品经理**（需要了解业务流程和功能边界）。

# Task (任务)
请仔细阅读并分析当前提供的所有项目代码，对该目录下的整个代码工程进行全面分析，编写一份非常详尽的《项目技术架构与实现文档》。确保内容专业、完整、开发人员
或产品人员能够通过文档直接看清楚代码的实现逻辑。

# Requirements (要求)
1. **深度分析**：不要只列出文件名，要分析代码背后的设计意图。
2. **逻辑清晰**：从宏观架构到微观实现，层层递进。
3. **可视化**：凡是涉及复杂流程、架构图、ER 图的地方，请使用 Mermaid 语法生成图表。
4. **格式规范**：使用 Markdown 格式，利用标题、加粗、代码块来增强可读性。

# Output Structure (文档输出结构)
请严格按照以下章节进行输出：

## 1. 项目概览 (Project Overview)
- **核心功能**：一句话定义这个项目是做什么的。
- **业务价值**：它解决了什么问题？
- **核心流程**：用户使用该产品的关键路径（User Journey）是什么？

## 2. 技术栈与选型分析 (Tech Stack & Rationale)
- **列出前端、后端、数据库、中间件的具体技术选型（包括版本）**。
- **关键决策分析**：为什么选用这些技术？（例如：为什么用 Next.js 而不是 React SPA？为什么用 PostgreSQL 而不是 MongoDB？请根据代码特征推断）。 
— **前端架构详细分析**：确定前端的框架和版本，以及前端代码的架构逻辑、前端通信协议等
— **后端架构详细分析**：确定后端的框架和版本

## 3. 系统架构设计 (System Architecture)
- **架构模式**：采用的是 MVC、DDD、微服务还是单体架构？
- **目录结构说明**：提供关键目录的 Tree 结构，并解释每个目录的职责（不仅仅是翻译文件名，要解释作用）。
- **配套系统架构图**：绘制系统顶层架构图（展示前端、API、服务层、数据库的交互）。
- **架构风格**：（微服务、单体、模块化、领域驱动等）
- **入口点定位**：找到项目的主启动文件和命令行接口实现
- **Web服务架构**：识别是需要使用什么框架可以实现用户认证系统
- **前后端分离模式**：分析前端与后端服务的通信机制
- **路由系统**：映射所有HTTP端点和API路由结构
- **会话管理**：当前是否有任何用户状态或会话处理机制
- **Docker集成**：容器化部署对认证系统的影响
- **分层结构、模块划分**
- **核心组件与服务间交互关系**
- **关键技术栈选型**：（语言、框架、数据库、中间件等）及选型理由
- **系统架构图**
- **模块间交互图**
- **部署架构图**
- **ER图**
- **类图、时序图（重点流程）**

## 4. 核心模块与实现逻辑 (Core Modules & Implementation)
*这是文档的重点，请详细拆解 3-5 个最核心的业务模块。*
对于每个核心模块：
- **功能描述**。
- **关键类/文件**：列出核心文件路径。
- **核心方法说明**：解释关键函数的输入、处理逻辑、输出。
- **数据流向**：数据是如何从接口层流向数据库的。
- **流程图**：请用 Mermaid `sequenceDiagram` 绘制该模块的核心时序图。
- **按模块组织内容**：输出模块作用与职责边界、核心逻辑说明、输入/输出说明（参数、数据结构）
- **关键函数/类/接口列表**
- **指明核心业务流程在代码中的对应文件路径与位置**
- **模块之间的依赖关系**

## 5. 数据模型设计 (Data Models)
- **分析核心实体（Entities）及其关系**
- **数据库表的SQL描述**：描述数据库所有表结构；如果是 NoSQL 或 TypeScript，描述核心 Interface/Type 定义。
- **请用 Mermaid `erDiagram` 绘制核心实体关系图**
- **数据库类型（MySQL、PostgreSQL、MongoDB 等）**
- **每张表的表结构（字段、类型、含义、约束、索引）**
- **表关系（ER 描述）**
- **视图、存储过程、触发器说明（如有）**
- **核心业务相关数据流说明**：数据从哪里产生？哪些模块写入？哪些模块读取使用？

## 6. 关键配置与环境 (Configuration & Setup)
- **环境变量说明（`.env`）**。
- **核心配置文件分析**：（如 `next.config.js`, `package.json` 中的关键依赖）。
- **所有配置文件的说明**，如：application.yml / .properties，.env，配置中心参数，每个配置项的作用、取值范围、默认值，不同环境（dev/test/prod）差异说明
- **第三方服务密钥与外部依赖的说明（敏感信息避免展示）**

## 7. 潜在改进与建议 (Recommendations)
- **基于代码质量、性能、安全性，给出专业的改进建议**

## 8. 接口文档（API 文档 / 内部接口文档）
- **按照标准 API 文档格式输出：
- **接口 URL**
- **请求方法**
- **功能说明**
- **请求参数（含类型、是否必填、示例）**
- **返回结构（含字段解释）**
- **错误码说明**
- **对应到代码中的接口方法与文件路径**
- **如代码中有 Swagger/OpenAPI 配置，请解析并反向生成文档**

## 9. 测试文档

- **单元测试说明：测试覆盖范围、对应文件、示例**
- **集成测试说明：流程、依赖组件**
- **典型测试用例列表**
- **已知边界条件、异常场景、风险点**
- **代码中对风险点的处理逻辑说明**