这是一个非常核心的阅读辅助功能。为了将“AI解读”打造成用户阅读长文时的“外脑”，我们需要将其设计为一个**多层次、可交互的侧边栏（Sidebar）或抽屉（Drawer）**。

不仅仅是简单的“总结”，而是要根据用户的阅读深度，提供从“略读”到“研读”的递进式服务。

以下是为您规划的 **NewsBox 阅读页“AI 解读”功能详细设计方案**。

---

# 产品功能规划书：阅读页 AI 深度解读

## 1. 交互形态与入口 (UI/UX)

* **入口位置：** 阅读页底部工具栏中央 / 顶部导航栏右侧 / 选中文本后的浮动菜单。
* **呈现方式：** **右侧滑动抽屉 (Right Slide-over Panel)**。
* *理由：* 不遮挡原文，允许用户“左边看文，右边看AI”，实现对照阅读。


* **交互逻辑：** 点击“AI 解读”按钮，侧边栏滑出，默认展示“AI 快读”。顶部有 Tab 切换或锚点导航，分别对应四个核心维度。

---

## 2. 功能维度详细规划

### 维度 1：AI 快读 (Flash Summary)

> **定位：** 帮助用户在 30 秒内判断文章价值，决定是否细读。

* **一句话直击 (The Hook)：** 用 <50 字的精炼语言，概括文章最核心的信息增量。
* **3-5 点摘要 (Key Takeaways)：** 使用 Emoji 列表展示核心观点。
* **情感/立场标签：** AI 自动分析文章基调（如：`客观中立`、`看涨`、`批判性`、`软广嫌疑`）。
* **阅读预计时间：** 基于字数和内容密度估算（如“深度阅读需 8 分钟”）。

### 维度 2：关键问题 (Key Questions & Answers)

> **定位：** 引导式阅读（Socratic Method）。将被动接收信息转变为主动思考。

* **核心设问：** AI 提炼出这篇文章试图解决的 3 个主要问题。
* *例：* “Q: OpenAI 此次架构调整的真实意图是什么？”


* **精准回答：** 针对每个问题，从文中提取答案，并附带“原文跳转链接”。
* **未解之谜：** (亮点功能) AI 指出文章**没有回答**的问题或逻辑漏洞（如：“文章未提及该技术对算力成本的具体影响”）。

### 维度 3：AI 精读 (Deep Dive Analysis)

> **定位：** 结构化拆解。适合需要做笔记、写研报的专业用户。

* **思维导图 (Mind Map)：** 自动生成文章的 Markdown 树状结构图（支持点击节点跳转原文）。
* **利益相关方分析 (Stakeholder Analysis)：**
* 表格展示：**主体** (Who) | **动作** (Did What) | **影响** (Impact)。


* **数据透视 (Data Table)：** 自动把文中散落的数字（营收、增长率、日期）整理成一张表格。
* **底层逻辑：** AI 尝试分析文章背后的深层逻辑或行业背景（如：“这实际上是传统车企对造车新势力的反击信号”）。

### 维度 4：AI 批注 (Annotation Copilot)

> **定位：** 针对“用户已标注内容”的深度伴读。让用户的笔记“活”起来。
> *注意：此功能需结合用户在阅读时的划线/高亮操作。*

* **场景 A：选中解释 (On-Demand Explanation)**
* **交互：** 用户在左侧原文划线 -> 浮动菜单点“AI 解读”。
* **输出：** AI 在右侧面板解释这段话的**背景知识**、**专业术语**或**潜台词**。


* **场景 B：笔记对话 (Chat with Note)**
* **交互：** 用户划线并写下笔记（如“这个观点存疑”）。
* **输出：** AI 自动识别用户的笔记意图，进行反馈。
* *用户笔记：* “这数据好像不对。”
* *AI 回复：* “我查证了该公司的上季度财报，数据确实有出入，官方数据应为...”




* **场景 C：全局批注分析 (Global Analysis)**
* **功能：** 如果用户全篇划了 10 处重点，AI 综合分析这 10 处重点，总结**“用户的关注点偏好”**（如：“您在这篇文章中主要关注了‘商业变现’相关的段落，以下是针对该视角的补充...”）。



---

## 3. 技术实现方案

### 3.1 数据流架构

采用 **Streaming (流式输出)** 提升体验。

1. **Frontend (Next.js):** 用户点击 -> 建立 SSE (Server-Sent Events) 连接。
2. **Backend (Supabase Edge Function):**
* Step 1: 获取文章全文。
* Step 2: 并发请求 LLM（或者串行，先出快读，再出精读）。
* Step 3: 将 Chunk 数据实时推送到前端。


3. **Caching (Redis/Postgres):**
* 对于公共文章，AI 解读结果应存入数据库。第二个用户点击时，直接从 DB 读取，**秒开且省 Token**。



### 3.2 提示词工程 (Prompt Engineering Strategy)

为了保证效果，建议将不同维度拆分为不同的 Prompt，或者使用一个结构化的大 Prompt。

**推荐：结构化 JSON Prompt (适合 DeepSeek/OpenAI)**

```markdown
# Role
你是一个资深的媒体主编和行业分析师。

# Input
文章标题：{{title}}
文章内容：{{content}}
用户现有批注：{{user_annotations}} (可选)

# Task
请对文章进行深度解读，输出 JSON 格式，包含以下字段：

1. **fast_read** (AI快读):
   - summary: 一句话总结 (50字内)
   - bullet_points: [3-5个关键点]
   - sentiment: 情感倾向
   
2. **key_questions** (关键问题):
   - 提取 3 个核心问题 (Q) 和对应答案 (A)

3. **deep_dive** (AI精读):
   - structure: Markdown 格式的层级大纲
   - stakeholders: [{ entity: "主体", action: "动作", impact: "影响" }]
   - underlying_logic: 底层逻辑分析

4. **annotation_analysis** (AI批注 - 仅当有 user_annotations 时):
   - 对用户划线的重点进行扩展解释或背景补充。

# Constraints
- 保持客观、专业。
- 关键结论必须基于原文。
- 输出 JSON 格式。

```

---

## 4. 界面展示原型描述 (UI Mockup)

**右侧抽屉面板布局：**

* **Header:**
* 标题：“AI 智能解读”
* Tab: `[概览]`, `[问答]`, `[精读]`, `[批注]`


* **Body (Scrollable):**
* **(卡片 1) ⚡️ AI 快读**
* 加粗的一句话摘要。
* 3 个带 `•` 的观点。
* 标签：`#深度好文` `#看涨`


* *--- 分割线 ---*
* **(卡片 2) ❓ 关键问题**
* **Q1:** ...
* **A:** ... (点击定位原文)


* *--- 分割线 ---*
* **(卡片 3) 🧐 深度剖析**
* **利益相关方表格**
* **文章脉络树 (Tree View)**




* **Footer:**
* **输入框：** “对解读有疑问？继续追问 AI...” (支持 RAG 对话)



---

## 5. 开发优先级 (Roadmap)

1. **Phase 1 (MVP):** 实现 **AI 快读** 和 **关键问题**。这是用户感知最强的功能。
2. **Phase 2:** 实现 **AI 精读**（Markdown 大纲生成）。
3. **Phase 3:** 实现 **AI 批注**。这需要前端复杂的文本选择交互和后端的数据联动，开发成本较高。
4. **Phase 4:** **我的解读历史**。将每次的 AI 解读结果持久化保存，变成知识库的一部分。