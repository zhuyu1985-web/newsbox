# Change: Add Smart Topics (P1 智能专题/自动聚类)

## Why
“我的收藏”是按篇的线性流，适合回看与管理，但当收藏规模增大后，用户在写综述/做研究时会遇到“信息碎片化”：同一主题的内容散落在不同时间与来源，难以快速形成脉络。

## What Changes
- 在“知识库”中新增 P1 子模块：**智能专题（Smart Topics）**
  - 自动/按需对用户全库笔记进行主题聚类，形成“专题”
  - 专题详情提供：
    - 文章/笔记列表（按时间）
    - 时间线视图（以时间顺序串联专题内关键条目）
    - 专题报告（Markdown）
- 新增后台能力：embedding 生成、聚类、专题结果持久化与增量更新

## Scope
- **P1**：智能专题（自动聚类）
  - 支持手动触发“生成/刷新专题”
  - 支持专题列表 + 专题详情（列表/时间线/报告）
  - 结果持久化（下次打开可直接查看）

## Out of Scope
- **P2**：素材库（金句/数据/观点卡片墙）
- **P3**：实体关系图谱（可视化图谱 + 三元组存储）
- 跨用户公共专题/协作

## Impact
- Affected specs:
  - `knowledge-base`（新增子导航/入口与专题交互）
- Affected code:
  - 新增 API：`/api/knowledge/topics/*`
  - Dashboard 知识库 UI：在现有对话基础上新增“智能专题”视图
  - 数据库：新增专题/聚类相关表（需要 RLS）

## Risks
- Embedding/聚类的成本与耗时：需限制每日处理量、支持增量与缓存。
- 模型/供应商切换：需抽象 embedding provider，避免强绑定。
- 质量：聚类效果需要可解释性（专题名/关键词/代表内容）。
