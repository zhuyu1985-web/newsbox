# 测试指南：沉浸式阅读页

## 🎯 功能访问

### 1. 运行数据库迁移（必需）

在使用新功能前，必须先运行数据库迁移：

```bash
# 方式A: 使用 Supabase CLI
supabase db push

# 方式B: 在 Supabase Dashboard 中执行
# 1. 打开 Supabase Dashboard
# 2. 进入 SQL Editor
# 3. 复制 supabase/migrations/008_add_reader_page_schema.sql 的内容
# 4. 执行 SQL
```

### 2. 访问新的阅读页

**✨ 沉浸式阅读页已直接替换原详情页！**

路由保持原来不变：
```
/notes/[笔记ID]
```

**示例：**
- 访问笔记详情页：`/notes/abc123`
- 自动显示新的沉浸式阅读界面

### 3. 如何测试

1. **启动开发服务器**：
   ```bash
   npm run dev
   ```

2. **访问现有笔记**：
   - 进入 Dashboard：`/dashboard`
   - 点击任意笔记
   - 自动进入新的沉浸式阅读页

3. **检查功能**：
   - ✅ 页面是否正常加载
   - ✅ 顶部导航栏是否显示
   - ✅ 视图切换器（沉浸阅读 | 原始网页 | AI速览 | 网页存档）
   - ✅ 三栏布局（左侧大纲 | 中间内容 | 右侧批注）
   - ✅ 禅模式切换（按 Esc 键测试）
   - ✅ 阅读进度条（滚动页面时顶部极细进度条）

## 🐛 常见问题排查

### 问题1: 页面 404 Not Found
- **原因**: 可能是 Next.js 未识别新路由
- **解决**: 
  ```bash
  # 重启开发服务器
  Ctrl+C
  npm run dev
  ```

### 问题2: 数据库错误
- **原因**: 未运行数据库迁移
- **解决**: 执行上述"运行数据库迁移"步骤

### 问题3: 页面空白
- **原因**: 可能是笔记不存在或权限问题
- **解决**: 
  - 检查浏览器控制台错误
  - 确认笔记 ID 正确
  - 确认已登录

### 问题4: 侧边栏不显示
- **原因**: 响应式设计，小屏幕会隐藏侧栏
- **解决**: 
  - 左侧栏需要 `lg` 断点以上（≥1024px）
  - 右侧栏需要 `xl` 断点以上（≥1280px）
  - 或切换到禅模式再退出

## ✅ 已完成功能清单

### Phase 1: 数据库 Schema（✓ 完成）
- ✅ 新增 5 个表：`web_archives`, `video_chapters`, `transcripts`, `reading_progress`, `user_settings`
- ✅ 扩展 4 个现有表
- ✅ RLS 策略配置
- ⚠️ **待执行**: 运行迁移到数据库

### Phase 2: 基础布局（✓ 完成）
- ✅ 新路由：`/notes/[id]/read`
- ✅ 三栏响应式布局
- ✅ 全局导航栏（进度条、视图切换、菜单）
- ✅ 左侧栏（文档大纲、视频章节）
- ✅ 中间内容区（图文阅读器、视频播放器占位、其他视图）
- ✅ 右侧栏（批注列表、AI解读、逐字稿）
- ✅ 禅模式（Esc 快捷键）

## 📝 待完成功能

以下功能已创建组件框架，但核心逻辑待实现：

### Phase 3: 图文阅读增强
- ⏳ Jina Reader API 集成
- ⏳ 划词气泡菜单
- ⏳ Lightbox 图片查看器
- ⏳ 代码高亮

### Phase 4+: 其他模块
- ⏳ 批注系统完整功能
- ⏳ AI 分析
- ⏳ 视频播放器
- ⏳ ASR 转写
- ⏳ 网页存档
- ⏳ 阅读器设置
- ⏳ 阅读进度追踪
- ...（共 20 个阶段）

## 🔄 快速验证流程

```bash
# 1. 确保依赖已安装
npm install

# 2. 运行数据库迁移（如果还没运行）
supabase db push

# 3. 启动开发服务器
npm run dev

# 4. 在浏览器中访问
# http://localhost:3000/notes/[某个笔记ID]/read
```

## 📊 当前进度

- ✅ Phase 1: 数据库 Schema（100%）
- ✅ Phase 2: 基础布局（100%）
- ⏳ Phase 3-20: 待实现（0%）

**总体进度**: 2/20 阶段完成（10%）

