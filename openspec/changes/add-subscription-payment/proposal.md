# Change: Add Subscription Payment System

## Why

当前系统缺乏付费会员机制，用户注册后可无限期免费使用所有功能。需要引入订阅付费体系以实现：
1. 商业变现：通过会员订阅获取收入
2. 功能分级：区分基础功能与 AI 高级功能
3. 试用转化：14 天全功能试用后引导付费

## What Changes

### 1. 会员等级体系
- **试用用户**：新注册用户免费体验 14 天 Pro + AI 全功能
- **NewsBox Pro**：¥9.9/年，解锁登录权限、无限收藏/归档/标签管理、无广告阅读
- **NewsBox AI**：¥19.9/年，包含 Pro 全部权益 + AI 功能（AI 解读、知识库、智能专题、AI 金句提炼、AI 快照）

### 2. 登录拦截机制
- **试用期后**：未付费用户登录时跳转至 /pricing 页面，提示"试用已到期，请订阅后继续使用"
- **会员过期后**：自动降级为无权限状态，下次登录触发拦截

### 3. AI 功能权限检查
- Pro 用户使用 AI 功能时，弹出提示"该功能需要 NewsBox AI 会员"，可跳转 /pricing 升级

### 4. 支付集成
- 集成 z-pay 支付（支付宝 + 微信）
- 服务端签名生成、异步回调验签、订单状态管理

### 5. 到期提醒
- 会员到期前 7 天、3 天，系统通知栏推送提醒
- 到期后自动降级，下次登录拦截

## Impact

- **Affected specs**: `auth`, `subscription` (新增), `payment` (新增)
- **Affected code**:
  - 数据库：扩展 `user_memberships` 表，新增 `subscriptions`、`orders` 表
  - 前端：`/pricing` 页面、登录流程、AI 功能组件、通知系统
  - 后端：`/api/payment/*` 支付接口、权限检查中间件
- **Breaking changes**: 无（新增功能，不影响现有行为）

## Open Questions

1. **支付方式**：是否同时支持支付宝和微信支付？还是只支持一种？
2. **升级差价**：Pro 用户升级到 AI 是否支持补差价？还是等到期后重新购买？
3. **退款政策**：是否支持退款？退款后如何处理会员权益？
